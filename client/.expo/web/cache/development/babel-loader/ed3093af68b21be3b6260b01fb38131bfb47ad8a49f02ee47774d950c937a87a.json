{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { useState, useRef } from \"react\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport { CardField, useConfirmPayment } from \"@stripe/stripe-react-native\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar Pasarella = function Pasarella(_ref) {\n  var route = _ref.route;\n  var _route$params = route.params,\n    Cart = _route$params.Cart,\n    tot = _route$params.tot,\n    userid = _route$params.userid;\n  console.log(\"Esto me llega de props CArrito:\", Cart);\n  var cardFieldRef = useRef(null);\n  var items = [{\n    videogameId: 3498,\n    videogameName: \"Grand Theft Auto V\",\n    unitPrice: 20,\n    quantity: 2\n  }, {\n    videogameId: 4200,\n    videogameName: \"Portal 2\",\n    unitPrice: 20,\n    quantity: 5\n  }];\n  var datos = {\n    items: Cart,\n    amount: tot,\n    userId: userid\n  };\n  var _useState = useState(),\n    _useState2 = _slicedToArray(_useState, 2),\n    cardDetails = _useState2[0],\n    setCardDetails = _useState2[1];\n  var _useConfirmPayment = useConfirmPayment(),\n    confirmPayment = _useConfirmPayment.confirmPayment,\n    loading = _useConfirmPayment.loading;\n  var subscribe = function () {\n    var _ref2 = _asyncToGenerator(function* () {\n      try {\n        var response = yield fetch(\"https://gameshop-production-e844.up.railway.app/pay\", {\n          method: \"POST\",\n          body: JSON.stringify({\n            datos: datos\n          }),\n          headers: {\n            \"Content-Type\": \"application/json\"\n          }\n        });\n        var data = yield response.json();\n        console.log(\"lo que hay en data\");\n        console.log(data);\n        if (!response.ok) return Alert.alert(data.message);\n        var clientSecret = data.clientSecret;\n        console.log(\"estoy bien\");\n        var _yield$confirmPayment = yield confirmPayment(clientSecret, {\n            paymentMethodType: \"Card\"\n          }),\n          paymentIntent = _yield$confirmPayment.paymentIntent,\n          error = _yield$confirmPayment.error;\n        if (error) {\n          alert(\"Payment Confirmation Error \" + error.message);\n        } else if (paymentIntent) {\n          var itemsFormat = JSON.stringify(datos.items);\n          console.log(\"items formateados----> \" + itemsFormat);\n          try {\n            var _response = yield fetch(\"https://gameshop-production-e844.up.railway.app/createSale\", {\n              method: \"POST\",\n              body: JSON.stringify({\n                paymentId: paymentIntent.id,\n                amount: datos.amount,\n                items: itemsFormat,\n                userId: 945\n              }),\n              headers: {\n                \"Content-Type\": \"application/json\"\n              }\n            });\n            var _data = yield _response.json();\n            console.log(typeof _data.message);\n            if (_data.message === \"ok\") {\n              console.log(\"Entro a pago exitoso\");\n              alert(\"Payment Successful\");\n              console.log(\"Payment successful \", paymentIntent.status);\n            } else {\n              alert(\"It was not possible to complete the purchase, the payment has been refunded.\");\n            }\n          } catch (error) {\n            alert(\"Payment Confirmation Error \" + error.message);\n          }\n          if (cardFieldRef.current) {\n            cardFieldRef.current.clear();\n          }\n        }\n      } catch (err) {\n        console.error(err);\n        Alert.alert(\"Something went wrong, try again later!\");\n      }\n    });\n    return function subscribe() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  return _jsxs(View, {\n    style: styles.container,\n    children: [_jsx(View, {\n      children: _jsx(Image, {\n        style: styles.mario,\n        source: require(\"../../../../assets/gameShop-white-mario.png\")\n      })\n    }), _jsx(CardField, {\n      ref: cardFieldRef,\n      postalCodeEnabled: true,\n      placeholder: {\n        number: \"4242 4242 4242 4242\"\n      },\n      cardStyle: styles.card,\n      style: styles.cardContainer,\n      onCardChange: function onCardChange(cardDetails) {\n        setCardDetails(cardDetails);\n      }\n    }), _jsx(Button, {\n      onPress: subscribe,\n      title: \"Pay\",\n      disabled: loading\n    })]\n  });\n};\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    justifyContent: \"center\",\n    margin: 20\n  },\n  input: {\n    backgroundColor: \"#efefefef\",\n    borderRadius: 8,\n    fontSize: 20,\n    height: 50,\n    padding: 10\n  },\n  card: {\n    backgroundColor: \"#efefefef\"\n  },\n  cardContainer: {\n    height: 100,\n    marginVertical: 30\n  }\n});\nexport default Pasarella;","map":{"version":3,"names":["React","useState","useRef","View","Text","StyleSheet","TextInput","Button","Alert","Image","CardField","useConfirmPayment","jsx","_jsx","jsxs","_jsxs","Pasarella","_ref","route","_route$params","params","Cart","tot","userid","console","log","cardFieldRef","items","videogameId","videogameName","unitPrice","quantity","datos","amount","userId","_useState","_useState2","_slicedToArray","cardDetails","setCardDetails","_useConfirmPayment","confirmPayment","loading","subscribe","_ref2","_asyncToGenerator","response","fetch","method","body","JSON","stringify","headers","data","json","ok","alert","message","clientSecret","_yield$confirmPayment","paymentMethodType","paymentIntent","error","itemsFormat","paymentId","id","status","current","clear","err","apply","arguments","style","styles","container","children","mario","source","require","ref","postalCodeEnabled","placeholder","number","cardStyle","card","cardContainer","onCardChange","onPress","title","disabled","create","flex","justifyContent","margin","input","backgroundColor","borderRadius","fontSize","height","padding","marginVertical"],"sources":["C:/Users/Davico/Mi unidad/Personal/HENRY/ProyectoFinal_GameShop/GameShop/GameShop/client/src/components/Views/Forms/Cart/Pasarella.jsx"],"sourcesContent":["import React, { useState, useRef } from \"react\";\r\nimport { View, Text, StyleSheet, TextInput, Button, Alert, Image } from \"react-native\";\r\nimport { CardField, useConfirmPayment } from \"@stripe/stripe-react-native\";\r\n\r\n\r\nconst Pasarella = ({ route }) => {\r\n  const { Cart ,tot,userid} = route.params;\r\n\r\n  console.log(\"Esto me llega de props CArrito:\", Cart);\r\n  const cardFieldRef = useRef(null);\r\n  //Data\r\n  const items = [{ videogameId: 3498, videogameName: \"Grand Theft Auto V\", unitPrice: 20, quantity: 2 }, \r\n                 { videogameId: 4200, videogameName: \"Portal 2\", unitPrice: 20, quantity: 5 }];\r\n  var datos = {\r\n    items: Cart,\r\n    amount: tot,\r\n    userId: userid,\r\n  };\r\n  \r\n  const [cardDetails, setCardDetails] = useState();\r\n  const { confirmPayment, loading } = useConfirmPayment();\r\n\r\n  const subscribe = async () => {\r\n\r\n    try {\r\n        const response = await fetch(\"https://gameshop-production-e844.up.railway.app/pay\", {  \r\n        method: \"POST\",\r\n        body: JSON.stringify({ datos }),\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n      });\r\n      const data = await response.json();\r\n      console.log(\"lo que hay en data\")\r\n      console.log(data)\r\n      if (!response.ok) return Alert.alert(data.message);\r\n      const clientSecret = data.clientSecret;\r\n      console.log(\"estoy bien\")\r\n      const { paymentIntent, error } = await confirmPayment(clientSecret, {\r\n        paymentMethodType: \"Card\",\r\n      });\r\n      if (error) {\r\n        alert(`Payment Confirmation Error ${error.message}`);\r\n      } else if (paymentIntent) {\r\n        const itemsFormat = JSON.stringify(datos.items)\r\n        console.log(\"items formateados----> \" + itemsFormat);\r\n        try {\r\n\r\n            const response = await fetch(\"https://gameshop-production-e844.up.railway.app/createSale\", {\r\n            method: \"POST\",\r\n            body: JSON.stringify({\r\n              paymentId: paymentIntent.id,\r\n              amount: datos.amount,\r\n              items: itemsFormat,\r\n              userId: 945\r\n            }),\r\n            headers: {\r\n              \"Content-Type\": \"application/json\",\r\n            },\r\n\r\n          });\r\n          const data = await response.json();\r\n          console.log(typeof data.message)\r\n          if (data.message === \"ok\") {\r\n            console.log(\"Entro a pago exitoso\")\r\n            alert(\"Payment Successful\");\r\n            console.log(\"Payment successful \", paymentIntent.status);\r\n          } else {\r\n            alert(\"It was not possible to complete the purchase, the payment has been refunded.\")\r\n          }\r\n\r\n        } catch (error) {\r\n          alert(`Payment Confirmation Error ${error.message}`);\r\n        }\r\n\r\n        if (cardFieldRef.current) {\r\n          cardFieldRef.current.clear(); // Limpia el contenido del CardField\r\n        }\r\n\r\n      }\r\n    } catch (err) {\r\n      console.error(err);\r\n      Alert.alert(\"Something went wrong, try again later!\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <View >\r\n        <Image\r\n          style={styles.mario}\r\n          source={require(\"../../../../assets/gameShop-white-mario.png\")}\r\n        ></Image>\r\n      </View>\r\n      <CardField\r\n        ref={cardFieldRef}\r\n        postalCodeEnabled={true}\r\n        placeholder={{\r\n          number: \"4242 4242 4242 4242\",\r\n        }}\r\n        cardStyle={styles.card}\r\n        style={styles.cardContainer}\r\n        onCardChange={cardDetails => {\r\n          setCardDetails(cardDetails);\r\n        }}\r\n      />\r\n      <Button onPress={subscribe} title=\"Pay\" disabled={loading} />\r\n    </View>\r\n  );\r\n};\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    justifyContent: \"center\",\r\n    margin: 20,\r\n  },\r\n  input: {\r\n    backgroundColor: \"#efefefef\",\r\n\r\n    borderRadius: 8,\r\n    fontSize: 20,\r\n    height: 50,\r\n    padding: 10,\r\n  },\r\n  card: {\r\n    backgroundColor: \"#efefefef\",\r\n  },\r\n  cardContainer: {\r\n    height: 100,\r\n    marginVertical: 30,\r\n  },\r\n});\r\n\r\nexport default Pasarella;\r\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,MAAM,QAAQ,OAAO;AAAC,OAAAC,IAAA;AAAA,OAAAC,IAAA;AAAA,OAAAC,UAAA;AAAA,OAAAC,SAAA;AAAA,OAAAC,MAAA;AAAA,OAAAC,KAAA;AAAA,OAAAC,KAAA;AAEhD,SAASC,SAAS,EAAEC,iBAAiB,QAAQ,6BAA6B;AAAC,SAAAC,GAAA,IAAAC,IAAA;AAAA,SAAAC,IAAA,IAAAC,KAAA;AAG3E,IAAMC,SAAS,GAAG,SAAZA,SAASA,CAAAC,IAAA,EAAkB;EAAA,IAAZC,KAAK,GAAAD,IAAA,CAALC,KAAK;EACxB,IAAAC,aAAA,GAA4BD,KAAK,CAACE,MAAM;IAAhCC,IAAI,GAAAF,aAAA,CAAJE,IAAI;IAAEC,GAAG,GAAAH,aAAA,CAAHG,GAAG;IAACC,MAAM,GAAAJ,aAAA,CAANI,MAAM;EAExBC,OAAO,CAACC,GAAG,CAAC,iCAAiC,EAAEJ,IAAI,CAAC;EACpD,IAAMK,YAAY,GAAGxB,MAAM,CAAC,IAAI,CAAC;EAEjC,IAAMyB,KAAK,GAAG,CAAC;IAAEC,WAAW,EAAE,IAAI;IAAEC,aAAa,EAAE,oBAAoB;IAAEC,SAAS,EAAE,EAAE;IAAEC,QAAQ,EAAE;EAAE,CAAC,EACtF;IAAEH,WAAW,EAAE,IAAI;IAAEC,aAAa,EAAE,UAAU;IAAEC,SAAS,EAAE,EAAE;IAAEC,QAAQ,EAAE;EAAE,CAAC,CAAC;EAC5F,IAAIC,KAAK,GAAG;IACVL,KAAK,EAAEN,IAAI;IACXY,MAAM,EAAEX,GAAG;IACXY,MAAM,EAAEX;EACV,CAAC;EAED,IAAAY,SAAA,GAAsClC,QAAQ,CAAC,CAAC;IAAAmC,UAAA,GAAAC,cAAA,CAAAF,SAAA;IAAzCG,WAAW,GAAAF,UAAA;IAAEG,cAAc,GAAAH,UAAA;EAClC,IAAAI,kBAAA,GAAoC7B,iBAAiB,CAAC,CAAC;IAA/C8B,cAAc,GAAAD,kBAAA,CAAdC,cAAc;IAAEC,OAAO,GAAAF,kBAAA,CAAPE,OAAO;EAE/B,IAAMC,SAAS;IAAA,IAAAC,KAAA,GAAAC,iBAAA,CAAG,aAAY;MAE5B,IAAI;QACA,IAAMC,QAAQ,SAASC,KAAK,CAAC,qDAAqD,EAAE;UACpFC,MAAM,EAAE,MAAM;UACdC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;YAAEnB,KAAK,EAALA;UAAM,CAAC,CAAC;UAC/BoB,OAAO,EAAE;YACP,cAAc,EAAE;UAClB;QACF,CAAC,CAAC;QACF,IAAMC,IAAI,SAASP,QAAQ,CAACQ,IAAI,CAAC,CAAC;QAClC9B,OAAO,CAACC,GAAG,CAAC,oBAAoB,CAAC;QACjCD,OAAO,CAACC,GAAG,CAAC4B,IAAI,CAAC;QACjB,IAAI,CAACP,QAAQ,CAACS,EAAE,EAAE,OAAO/C,KAAK,CAACgD,KAAK,CAACH,IAAI,CAACI,OAAO,CAAC;QAClD,IAAMC,YAAY,GAAGL,IAAI,CAACK,YAAY;QACtClC,OAAO,CAACC,GAAG,CAAC,YAAY,CAAC;QACzB,IAAAkC,qBAAA,SAAuClB,cAAc,CAACiB,YAAY,EAAE;YAClEE,iBAAiB,EAAE;UACrB,CAAC,CAAC;UAFMC,aAAa,GAAAF,qBAAA,CAAbE,aAAa;UAAEC,KAAK,GAAAH,qBAAA,CAALG,KAAK;QAG5B,IAAIA,KAAK,EAAE;UACTN,KAAK,iCAA+BM,KAAK,CAACL,OAAS,CAAC;QACtD,CAAC,MAAM,IAAII,aAAa,EAAE;UACxB,IAAME,WAAW,GAAGb,IAAI,CAACC,SAAS,CAACnB,KAAK,CAACL,KAAK,CAAC;UAC/CH,OAAO,CAACC,GAAG,CAAC,yBAAyB,GAAGsC,WAAW,CAAC;UACpD,IAAI;YAEA,IAAMjB,SAAQ,SAASC,KAAK,CAAC,4DAA4D,EAAE;cAC3FC,MAAM,EAAE,MAAM;cACdC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;gBACnBa,SAAS,EAAEH,aAAa,CAACI,EAAE;gBAC3BhC,MAAM,EAAED,KAAK,CAACC,MAAM;gBACpBN,KAAK,EAAEoC,WAAW;gBAClB7B,MAAM,EAAE;cACV,CAAC,CAAC;cACFkB,OAAO,EAAE;gBACP,cAAc,EAAE;cAClB;YAEF,CAAC,CAAC;YACF,IAAMC,KAAI,SAASP,SAAQ,CAACQ,IAAI,CAAC,CAAC;YAClC9B,OAAO,CAACC,GAAG,CAAC,OAAO4B,KAAI,CAACI,OAAO,CAAC;YAChC,IAAIJ,KAAI,CAACI,OAAO,KAAK,IAAI,EAAE;cACzBjC,OAAO,CAACC,GAAG,CAAC,sBAAsB,CAAC;cACnC+B,KAAK,CAAC,oBAAoB,CAAC;cAC3BhC,OAAO,CAACC,GAAG,CAAC,qBAAqB,EAAEoC,aAAa,CAACK,MAAM,CAAC;YAC1D,CAAC,MAAM;cACLV,KAAK,CAAC,8EAA8E,CAAC;YACvF;UAEF,CAAC,CAAC,OAAOM,KAAK,EAAE;YACdN,KAAK,iCAA+BM,KAAK,CAACL,OAAS,CAAC;UACtD;UAEA,IAAI/B,YAAY,CAACyC,OAAO,EAAE;YACxBzC,YAAY,CAACyC,OAAO,CAACC,KAAK,CAAC,CAAC;UAC9B;QAEF;MACF,CAAC,CAAC,OAAOC,GAAG,EAAE;QACZ7C,OAAO,CAACsC,KAAK,CAACO,GAAG,CAAC;QAClB7D,KAAK,CAACgD,KAAK,CAAC,wCAAwC,CAAC;MACvD;IACF,CAAC;IAAA,gBA9DKb,SAASA,CAAA;MAAA,OAAAC,KAAA,CAAA0B,KAAA,OAAAC,SAAA;IAAA;EAAA,GA8Dd;EAED,OACExD,KAAA,CAACZ,IAAI;IAACqE,KAAK,EAAEC,MAAM,CAACC,SAAU;IAAAC,QAAA,GAC5B9D,IAAA,CAACV,IAAI;MAAAwE,QAAA,EACH9D,IAAA,CAACJ,KAAK;QACJ+D,KAAK,EAAEC,MAAM,CAACG,KAAM;QACpBC,MAAM,EAAEC,OAAO,8CAA8C;MAAE,CACzD;IAAC,CACL,CAAC,EACPjE,IAAA,CAACH,SAAS;MACRqE,GAAG,EAAErD,YAAa;MAClBsD,iBAAiB,EAAE,IAAK;MACxBC,WAAW,EAAE;QACXC,MAAM,EAAE;MACV,CAAE;MACFC,SAAS,EAAEV,MAAM,CAACW,IAAK;MACvBZ,KAAK,EAAEC,MAAM,CAACY,aAAc;MAC5BC,YAAY,EAAE,SAAAA,aAAAhD,WAAW,EAAI;QAC3BC,cAAc,CAACD,WAAW,CAAC;MAC7B;IAAE,CACH,CAAC,EACFzB,IAAA,CAACN,MAAM;MAACgF,OAAO,EAAE5C,SAAU;MAAC6C,KAAK,EAAC,KAAK;MAACC,QAAQ,EAAE/C;IAAQ,CAAE,CAAC;EAAA,CACzD,CAAC;AAEX,CAAC;AAED,IAAM+B,MAAM,GAAGpE,UAAU,CAACqF,MAAM,CAAC;EAC/BhB,SAAS,EAAE;IACTiB,IAAI,EAAE,CAAC;IACPC,cAAc,EAAE,QAAQ;IACxBC,MAAM,EAAE;EACV,CAAC;EACDC,KAAK,EAAE;IACLC,eAAe,EAAE,WAAW;IAE5BC,YAAY,EAAE,CAAC;IACfC,QAAQ,EAAE,EAAE;IACZC,MAAM,EAAE,EAAE;IACVC,OAAO,EAAE;EACX,CAAC;EACDf,IAAI,EAAE;IACJW,eAAe,EAAE;EACnB,CAAC;EACDV,aAAa,EAAE;IACba,MAAM,EAAE,GAAG;IACXE,cAAc,EAAE;EAClB;AACF,CAAC,CAAC;AAEF,eAAepF,SAAS"},"metadata":{},"sourceType":"module","externalDependencies":[]}