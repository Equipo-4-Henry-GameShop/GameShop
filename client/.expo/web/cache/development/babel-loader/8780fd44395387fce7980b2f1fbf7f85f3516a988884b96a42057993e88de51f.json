{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { useState, useRef } from \"react\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport { CardField, useConfirmPayment } from \"@stripe/stripe-react-native\";\nimport { removeItem, cleanCart } from \"./CardCartController\";\nimport { useDispatch } from \"react-redux\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar Pasarella = function Pasarella(_ref) {\n  var route = _ref.route;\n  var dispatch = useDispatch();\n  var _route$params = route.params,\n    Cart = _route$params.Cart,\n    tot = _route$params.tot,\n    userid = _route$params.userid;\n  var cardFieldRef = useRef(null);\n  var datos = {\n    items: Cart,\n    amount: tot.toFixed(2) * 100,\n    userId: userid\n  };\n  var _useState = useState(),\n    _useState2 = _slicedToArray(_useState, 2),\n    cardDetails = _useState2[0],\n    setCardDetails = _useState2[1];\n  var _useConfirmPayment = useConfirmPayment(),\n    confirmPayment = _useConfirmPayment.confirmPayment,\n    loading = _useConfirmPayment.loading;\n  var subscribe = function () {\n    var _ref2 = _asyncToGenerator(function* () {\n      try {\n        var response = yield fetch(\"https://gameshop-production-e844.up.railway.app/pay\", {\n          method: \"POST\",\n          body: JSON.stringify({\n            datos: datos\n          }),\n          headers: {\n            \"Content-Type\": \"application/json\"\n          }\n        });\n        var data = yield response.json();\n        console.log(\"lo que hay en data\");\n        console.log(data);\n        if (!response.ok) return Alert.alert(data.message);\n        var clientSecret = data.clientSecret;\n        console.log(\"estoy bien\");\n        var _yield$confirmPayment = yield confirmPayment(clientSecret, {\n            paymentMethodType: \"Card\"\n          }),\n          paymentIntent = _yield$confirmPayment.paymentIntent,\n          error = _yield$confirmPayment.error;\n        if (error) {\n          alert(\"Payment Confirmation Error \" + error.message);\n        } else if (paymentIntent) {\n          var itemsFormat = JSON.stringify(datos.items);\n          console.log(\"items formateados----> \" + itemsFormat);\n          try {\n            var _response = yield fetch(\"https://gameshop-production-e844.up.railway.app/createSale\", {\n              method: \"POST\",\n              body: JSON.stringify({\n                paymentId: paymentIntent.id,\n                amount: datos.amount,\n                items: itemsFormat,\n                userId: userid\n              }),\n              headers: {\n                \"Content-Type\": \"application/json\"\n              }\n            });\n            var _data = yield _response.json();\n            console.log(typeof _data.message);\n            if (_data.message === \"ok\") {\n              console.log(\"Entro a pago exitoso\");\n              alert(\"Payment Successful\");\n              console.log(\"Payment successful \", paymentIntent.status);\n            } else {\n              alert(\"It was not possible to complete the purchase, the payment has been refunded.\");\n            }\n          } catch (error) {\n            alert(\"Payment Confirmation Error \" + error.message);\n          }\n          if (cardFieldRef.current) {\n            cardFieldRef.current.clear();\n          }\n        }\n      } catch (err) {\n        console.error(err);\n        Alert.alert(\"Something went wrong, try again later!\");\n      }\n    });\n    return function subscribe() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  return _jsxs(View, {\n    style: styles.container,\n    children: [_jsx(View, {\n      children: _jsx(Image, {\n        style: styles.mario,\n        source: require(\"../../../../assets/gameShop-white-mario.png\")\n      })\n    }), _jsx(CardField, {\n      ref: cardFieldRef,\n      postalCodeEnabled: true,\n      placeholder: {\n        number: \"4242 4242 4242 4242\"\n      },\n      cardStyle: styles.card,\n      style: styles.cardContainer,\n      onCardChange: function onCardChange(cardDetails) {\n        setCardDetails(cardDetails);\n      }\n    }), _jsx(Button, {\n      onPress: subscribe,\n      title: \"Pay\",\n      disabled: loading\n    })]\n  });\n};\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    justifyContent: \"center\",\n    margin: 20\n  },\n  input: {\n    backgroundColor: \"#efefefef\",\n    borderRadius: 8,\n    fontSize: 20,\n    height: 50,\n    padding: 10\n  },\n  card: {\n    backgroundColor: \"#efefefef\"\n  },\n  cardContainer: {\n    height: 100,\n    marginVertical: 30\n  }\n});\nexport default Pasarella;","map":{"version":3,"names":["React","useState","useRef","View","Text","StyleSheet","TextInput","Button","Alert","Image","CardField","useConfirmPayment","removeItem","cleanCart","useDispatch","jsx","_jsx","jsxs","_jsxs","Pasarella","_ref","route","dispatch","_route$params","params","Cart","tot","userid","cardFieldRef","datos","items","amount","toFixed","userId","_useState","_useState2","_slicedToArray","cardDetails","setCardDetails","_useConfirmPayment","confirmPayment","loading","subscribe","_ref2","_asyncToGenerator","response","fetch","method","body","JSON","stringify","headers","data","json","console","log","ok","alert","message","clientSecret","_yield$confirmPayment","paymentMethodType","paymentIntent","error","itemsFormat","paymentId","id","status","current","clear","err","apply","arguments","style","styles","container","children","mario","source","require","ref","postalCodeEnabled","placeholder","number","cardStyle","card","cardContainer","onCardChange","onPress","title","disabled","create","flex","justifyContent","margin","input","backgroundColor","borderRadius","fontSize","height","padding","marginVertical"],"sources":["C:/Users/juandiego/Documents/Escuela de desarrollo web/practica de JS/PF/MyGameshop/GameShop - copia/client/src/components/Views/Forms/Cart/Pasarella.jsx"],"sourcesContent":["import React, { useState, useRef } from \"react\";\r\nimport { View, Text, StyleSheet, TextInput, Button, Alert, Image } from \"react-native\";\r\nimport { CardField, useConfirmPayment } from \"@stripe/stripe-react-native\";\r\nimport { removeItem,cleanCart } from \"./CardCartController\";\r\nimport { useDispatch } from \"react-redux\";\r\n// import { navigate } from \"@react-navigation/routers/lib/typescript/src/CommonActions\";\r\n\r\nconst Pasarella = ({ route }) => {\r\n  const dispatch=useDispatch()\r\n  const { Cart ,tot,userid} = route.params;\r\n\r\n  // console.log(\"Esto me llega de props totl:\", userid);\r\n  const cardFieldRef = useRef(null);\r\n  //Data\r\n  // const items = [{ videogameId: 3498, videogameName: \"Grand Theft Auto V\", unitPrice: 20, quantity: 2 }, \r\n  //                { videogameId: 4200, videogameName: \"Portal 2\", unitPrice: 20, quantity: 5 }];\r\n  // console.log(\"--->>\")\r\n  // console.log(\"llega\",tot.toFixed(2))\r\n  var datos = {\r\n    items: Cart,\r\n    amount: (tot.toFixed(2)*100),\r\n    userId: userid,\r\n  };\r\n  // console.log(\"ese\",(datos.amount))\r\n  const [cardDetails, setCardDetails] = useState();\r\n  const { confirmPayment, loading } = useConfirmPayment();\r\n\r\n  const subscribe = async () => {\r\n\r\n    try {\r\n        const response = await fetch(\"https://gameshop-production-e844.up.railway.app/pay\", {  \r\n        method: \"POST\",\r\n        body: JSON.stringify({ datos }),\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n      });\r\n      const data = await response.json();\r\n      console.log(\"lo que hay en data\")\r\n      console.log(data)\r\n      if (!response.ok) return Alert.alert(data.message);\r\n      const clientSecret = data.clientSecret;\r\n      console.log(\"estoy bien\")\r\n      const { paymentIntent, error } = await confirmPayment(clientSecret, {\r\n        paymentMethodType: \"Card\",\r\n      });\r\n      if (error) {\r\n        alert(`Payment Confirmation Error ${error.message}`);\r\n      } else if (paymentIntent) {\r\n        const itemsFormat = JSON.stringify(datos.items)\r\n        console.log(\"items formateados----> \" + itemsFormat);\r\n        try {\r\n\r\n            const response = await fetch(\"https://gameshop-production-e844.up.railway.app/createSale\", {\r\n            method: \"POST\",\r\n            body: JSON.stringify({\r\n              paymentId: paymentIntent.id,\r\n              amount: datos.amount,\r\n              items: itemsFormat,\r\n              userId: userid\r\n            }),\r\n            headers: {\r\n              \"Content-Type\": \"application/json\",\r\n            },\r\n\r\n          });\r\n          const data = await response.json();\r\n          console.log(typeof data.message)\r\n          if (data.message === \"ok\") {\r\n            console.log(\"Entro a pago exitoso\")\r\n            alert(\"Payment Successful\");\r\n            console.log(\"Payment successful \", paymentIntent.status);\r\n            // dispatch(cleanCart())\r\n            // navigation.navigate('HomeScreen');\r\n            \r\n          } else {\r\n            alert(\"It was not possible to complete the purchase, the payment has been refunded.\")\r\n          }\r\n\r\n        } catch (error) {\r\n          alert(`Payment Confirmation Error ${error.message}`);\r\n        }\r\n\r\n        if (cardFieldRef.current) {\r\n          cardFieldRef.current.clear(); // Limpia el contenido del CardField\r\n        }\r\n\r\n      }\r\n    } catch (err) {\r\n      console.error(err);\r\n      Alert.alert(\"Something went wrong, try again later!\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <View >\r\n        <Image\r\n          style={styles.mario}\r\n          source={require(\"../../../../assets/gameShop-white-mario.png\")}\r\n        ></Image>\r\n      </View>\r\n      <CardField\r\n        ref={cardFieldRef}\r\n        postalCodeEnabled={true}\r\n        placeholder={{\r\n          number: \"4242 4242 4242 4242\",\r\n        }}\r\n        cardStyle={styles.card}\r\n        style={styles.cardContainer}\r\n        onCardChange={cardDetails => {\r\n          setCardDetails(cardDetails);\r\n        }}\r\n      />\r\n      <Button onPress={subscribe} title=\"Pay\" disabled={loading} />\r\n    </View>\r\n  );\r\n};\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    justifyContent: \"center\",\r\n    margin: 20,\r\n  },\r\n  input: {\r\n    backgroundColor: \"#efefefef\",\r\n\r\n    borderRadius: 8,\r\n    fontSize: 20,\r\n    height: 50,\r\n    padding: 10,\r\n  },\r\n  card: {\r\n    backgroundColor: \"#efefefef\",\r\n  },\r\n  cardContainer: {\r\n    height: 100,\r\n    marginVertical: 30,\r\n  },\r\n});\r\n\r\nexport default Pasarella;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}